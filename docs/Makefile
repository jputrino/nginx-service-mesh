THEME_MODULE = github.com/nginxinc/nginx-hugo-theme
## Pulls the current theme version from the Netlify settings
THEME_VERSION = $(NGINX_THEME_VERSION)
NETLIFY_DEPLOY_URL = ${DEPLOY_PRIME_URL}

.PHONY: all all-staging all-dev clean hugo-mod build-production build-staging build-dev docs-drafts docs

all: hugo-mod build-production

all-staging: hugo-mod build-staging

all-dev: hugo-mod build-dev

# Removes the public directory generated by the `hugo` command
clean:
	if [[ -d ${PWD}/public ]] ; then rm -rf ${PWD}/public && echo "Removed public directory" ; else echo "Did not find a public directory to remove" ; fi

hugo-mod:
	hugo mod get $(THEME_MODULE)@v$(THEME_VERSION)

# Builds using the Hugo "production" environment
# For deploys to docs.nginx.com only
build-production:
	./scripts/copy-docs.sh
	hugo --gc -e production
	
# Builds using the Hugo "staging" environment
# For deploys to docs-staging.nginx.com only
build-staging:
	./scripts/copy-docs.sh
	hugo --gc -e staging

# Builds using the Hugo "development" environment
# For deploys to docs-dev.nginx.com only
build-dev:
	./scripts/copy-docs.sh
	hugo --gc -e development

# Runs the Hugo server with content marked as draft
# Serves docs at localhost:1313
docs-drafts:
	hugo server -D --disableFastRender

# Runs the Hugo server
# Serves docs at localhost:1313
docs:
	hugo server --disableFastRender

deploy-preview: hugo-mod
	./scripts/copy-docs.sh 
	hugo --gc -d public/nginx-service-mesh -b ${NETLIFY_DEPLOY_URL}/nginx-service-mesh
